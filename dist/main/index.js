(()=>{var m="https://bro-cloud.herokuapp.com",E=class{constructor(){this.state={}}updateState(e){let n=e.target.name,o=e.target.value;this.state[n]=o}init(e){let n=e.children;for(let o of n)(o.nodeName==="INPUT"||o.nodeName==="SELECT")&&o.addEventListener("input",this.updateState.bind(this))}formData(){return this.state}},p={error:null,updateError(t){this.error=t;let e=document.querySelector(".error"),n=document.createTextNode(t);e.appendChild(n)},getError(){return this.error}};var v=JSON.parse(localStorage.getItem("user")),h={headers:{"Content-Type":"application/json"},method:"POST"},N=async(t,e,n)=>{if(v){let{clubId:a,_id:r}=v;h.headers.Authorization=`${r} ${a}`}e&&(h.body=JSON.stringify(e)),n&&(h.method=n);let o=await fetch(m+t,h);if(o.status>=200&&o.status<=299){let a=await o.json();return Promise.resolve(a)}p.updateError(o.error)},f={signup:async t=>{let e=await N("/signup",t);return Promise.resolve(e)},search:async t=>{let e=await N("/search",t);return Promise.resolve(e)},addVideo:async t=>{let e=await N("/addVideo",t);return Promise.resolve(e)}};var T=new E,S,b,d,u=JSON.parse(localStorage.getItem("user"));window.onload=()=>{let t=document.querySelector(".main--search");T.init(t),t.addEventListener("submit",k),V(),b=io(m),b.on("connect",()=>{console.log("Socket connected"),b.emit("setUpNs",u.clubId)}),d=io(`/${u.clubId}`),d.on("connect",()=>{console.log("Club NS socket connected"),q(),w()})};function q(){d.emit("setUpClub",u._id)}function w(){d.on("updatePlaylist",F),d.on("updateClubState",B)}function B(t){let e=u._id,n=u.clubId,o=document.querySelector("#videoId");if(!o){d.emit("playNext",n);return}A(o.value,t.ellapsedSeconds),L(t.members),e===t.members[0]&&setInterval(()=>{let a={seconds:S.getCurrentTime(),clubId:n};d.emit("updateSeconds",a)},1e3)}function V(){let e=document.querySelector(".main--history-list").getElementsByTagName("li");for(let n of e){let o=n.getAttribute("id"),a=n.getElementsByTagName("button")[0],r=a.getElementsByTagName("p")[0].innerText;x(a,null,r,o)}}function L(t){let n=document.querySelector(".main--squad-list").getElementsByTagName("li");t.forEach(o=>{for(let a of n)if(a.id.toString()===o.toString()){let r=a.getElementsByTagName("span");r[1].className="u--green-circle"}})}function A(t,e){S=new YT.Player("player",{height:"300",width:"500",videoId:t,playerVars:{cc_load_policy:0,autoplay:1,controls:0,disablekb:1,enablejsapi:1,fs:0,modestbranding:1,start:e},events:{onStateChange:D,onError:j}})}async function k(t){t.preventDefault();let e=T.formData(),n=await f.search(e),o=document.querySelector(".main--search-results");o.innerText="";let a=U(n.results);o.appendChild(a)}function x(t,e,n,o){t.addEventListener("click",async a=>{e&&(e.innerText="");let r={name:n,videoId:o},i=await f.addVideo(r);_(i)})}function U(t){let e=new DocumentFragment,n=document.createElement("ul");return n.className="main--result-list",t.items.forEach(o=>{let a=document.createElement("li"),r=document.createElement("button");r.className="btn--result",x(r,n,o.snippet.title,o.id.videoId);let i=document.createElement("span"),c=document.createTextNode(o.snippet.title);i.appendChild(c);let s=document.createElement("img");s.setAttribute("src",o.snippet.thumbnails.default.url),s.className="thumbnail",r.appendChild(i),r.appendChild(s),a.appendChild(r),n.appendChild(a)}),e.append(n),e}function _(t){let{currentlyPlaying:e,queuedVideo:n}=t;if(!n&&e.videoId){let o=document.querySelector(".main--playing"),a=o.getElementsByTagName("li")[0],r=document.createTextNode(e.name),i=document.createTextNode(e.userFullName),c=document.createElement("li"),s=document.createElement("div"),l=document.createElement("input");l.setAttribute("value",e.videoId),l.setAttribute("id","videoId"),l.setAttribute("type","hidden"),s.className="main--name-highlight",s.appendChild(i),c.appendChild(r),c.appendChild(s),c.appendChild(l),o.replaceChild(c,a)}if(n){let o=document.querySelector(".main--up-next"),a=document.createTextNode(n.name),r=document.createTextNode(n.userFullName),i=document.createElement("li"),c=document.createElement("div");c.className="main--name-highlight",c.appendChild(r),i.appendChild(a),i.appendChild(c),o.appendChild(i)}}function F(t){let{currentlyPlaying:e,playlist:n,seconds:o}=t,a=document.querySelector(".main--playing");a.innerText="";let r=document.createTextNode(e.name),i=document.createTextNode(e.userFullName),c=document.createElement("li"),s=document.createElement("div");s.className="main--name-highlight",s.appendChild(i),c.appendChild(r),c.appendChild(s),a.appendChild(c),S.loadVideoById(e.videoId,o);let l=document.querySelector(".main--up-next");l.innerText="",n.forEach(C=>{let I=document.createTextNode(C.name),P=document.createTextNode(C.userFullName),y=document.createElement("li"),g=document.createElement("div");g.className="main--name-highlight",g.appendChild(P),y.appendChild(I),y.appendChild(g),l.appendChild(y)})}async function D(t){let n=document.querySelector(".main--up-next").getElementsByTagName("li").length;t.data===YT.PlayerState.ENDED&&n>0&&d.emit("playNext",u.clubId)}function j(t){p.updateError(`Error loading video. code ${t.data}`),d.emit("playNext",u.clubId)}})();
//# sourceMappingURL=index.js.map
