(()=>{var se=Object.create;var Y=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ie=Object.getPrototypeOf,de=Object.prototype.hasOwnProperty;var fe=e=>Y(e,"__esModule",{value:!0});var ue=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var le=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of ne(t))!de.call(e,a)&&a!=="default"&&Y(e,a,{get:()=>t[a],enumerable:!(r=oe(t,a))||r.enumerable});return e},me=e=>le(fe(Y(e!=null?se(ie(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var R=ue(U=>{function ye(e,t){if(!t)return e;let r=Object.keys(t);return r.length>0&&r.forEach(a=>{let s=t[a];e.setAttribute(a,s)}),e}function he(e,t){if(t){let r=document.createTextNode(t);e.appendChild(r)}return e}U.createHTMLComponent=function(e){let t=new DocumentFragment;function r(a,s){a.forEach(o=>{let{name:n,attributes:d,content:i,children:u}=o,m=document.createElement(n),p=ye(m,d),F=he(p,i);s.append(F),u&&u.length>0&&r(u,F)})}return r(e,t),t}});var A="https://brocloud.ca",V=class{constructor(t=null){this.state={},this.customFn=t}updateState(t,r){this.state[t]=r}eventListener(t){let r=t.target.name,a=t.target.value;this.updateState.apply(this,[r,a])}init(t){let r=t.children;for(let a of r)(a.nodeName==="INPUT"||a.nodeName==="SELECT")&&a.addEventListener("input",this.eventListener.bind(this))}formData(){return this.state}},c=e=>{let t=document.querySelector(".error"),r=document.createTextNode(`${e.message}. Status: ${e.status}`);t.appendChild(r),setTimeout(()=>{t.innerText=""},2e4)};function xe(e){let t=e.video,r=document.querySelector(".main--up-next"),a=r.getElementsByTagName("li").length,s=document.createTextNode(t.name),o=document.createTextNode(t.userFullName),n=document.createElement("li");n.setAttribute("id",t._id);let d=document.createElement("div");d.className="main--name-highlight",d.appendChild(o);let i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("value",t.videoId),a===0?i.setAttribute("id","current-video"):i.setAttribute("class","next-video"),n.appendChild(i),n.appendChild(s),n.appendChild(d),r.appendChild(n),a===0&&l.loadVideoById(t.videoId)}var Q=xe;function ce(e){let r=document.querySelector(".main--squad-list").getElementsByTagName("li");for(let a of r){let s=a.getElementsByTagName("span")[1],o=a.id;e.includes(o)?s.className="u--green-circle":s.className="u--red-circle"}}var I=ce;var pe;function je(e){pe=e,document.querySelector("#current-video")&&l.seekTo(e.ellapsedSeconds,!0),I(e.members)}var P=je;var v=me(R());var _=JSON.parse(localStorage.getItem("user")),g={headers:{"Content-Type":"application/json"},method:"POST"},j=async(e,t,r)=>{if(_){let{clubId:o,_id:n}=_;g.headers.Authorization=`${n} ${o}`}t&&(g.body=JSON.stringify(t)),r&&(g.method=r);let a=await fetch(A+e,g),s=await a.json();if(a.status>=200&&a.status<=299)return Promise.resolve(s);c(s)},S={signupJoin:async(e,t)=>{let r=await j(`/signup/join/${t}`,e);return Promise.resolve(r)},signupCreate:async(e,t)=>{let r=await j(`/signup/create/${t}`,e);return Promise.resolve(r)},search:async e=>{let t=await j("/youtube-api/search",e);return Promise.resolve(t)},addVideo:async e=>{let t=await j("/music/addVideo",e);return Promise.resolve(t)},login:async e=>{let t=await j("/login",e);return Promise.resolve(t)}};async function Ie(e,t,r){e.addEventListener("click",async a=>{let s={name:t,videoId:r};await S.addVideo(s);let o=document.querySelector(".main--result-list");if(o){o.innerHTML="";let n=document.querySelector(".main--search-input");n.value=""}})}var T=Ie;function ge(e){let t=e.querySelector(".played-video");if(t){let r=t.value,a=e.getElementsByTagName("button")[0],s=a.querySelector(".played-video--name").innerText;T(a,s,r)}}var $=ge;function Se(){let t=document.querySelector(".main--history-list").getElementsByTagName("li");if(t.length>0)for(let r of t)$(r)}var O=Se;function Te(e){return[{name:"li",attributes:{id:e._id},content:e.name,children:[{name:"input",attributes:{type:"hidden",class:"next-video",value:e.videoId}},{name:"div",content:e.userFullName,attributes:{class:"main--name-highlight",value:e.videoId}}]}]}function Oe(e){return[{name:"li",attributes:{id:e._id},content:e.name,children:[{name:"input",attributes:{type:"hidden",id:"current-video",value:e.videoId}},{name:"div",content:e.userFullName,attributes:{class:"main--name-highlight",value:e.videoId}}]}]}function ve(e){return[{name:"li",attributes:{id:e._id},children:[{name:"input",attributes:{type:"hidden",class:"played-video",value:e.videoId}},{name:"button",attributes:{class:"btn--result btn--history"},children:[{name:"p",attributes:{class:"played-video--name"},content:e.name},{name:"p",content:e.userFullName,children:[{name:"span",attributes:{class:"main--timestamp"},content:` | ${e.playedAtTime}`}]}]}]}]}function De(e){let{upNext:t,history:r}=e,a=e.upNext[0],s=document.querySelector(".main--up-next"),o=document.querySelector(".main--history-list");s.innerHTML="",o.innerHTML="",a&&(l.loadVideoById(a.videoId),t.forEach((n,d)=>{if(d===0){let i=(0,v.createHTMLComponent)(Oe(n));s.append(i)}else{let i=(0,v.createHTMLComponent)(Te(n));s.append(i)}})),r.forEach(n=>{let d=(0,v.createHTMLComponent)(ve(n));o.append(d)}),O()}var B=De;function Me(){let e=document.querySelector("#current-video");return e?e.getAttribute("value"):!1}var y=Me;function N(e){if(e===null||e===!0||e===!1)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function x(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function D(e){x(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console!="undefined"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn(new Error().stack)),new Date(NaN))}var be=Math.pow(10,8)*24*60*60*1e3,C=6e4,w=36e5;var Dt=-be;function E(e,t){return x(2,arguments),D(e).getTime()-D(t).getTime()}var z={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)}},ke="trunc";function J(e){return e?z[e]:z[ke]}function M(e,t,r){x(2,arguments);var a=E(e,t)/1e3;return J(r==null?void 0:r.roundingMethod)(a)}function b(e,t){x(1,arguments);var r=t||{},a=r.additionalDigits==null?2:N(r.additionalDigits);if(a!==2&&a!==1&&a!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var s=Ce(e),o;if(s.date){var n=we(s.date,a);o=Ee(n.restDateString,n.year)}if(!o||isNaN(o.getTime()))return new Date(NaN);var d=o.getTime(),i=0,u;if(s.time&&(i=He(s.time),isNaN(i)))return new Date(NaN);if(s.timezone){if(u=qe(s.timezone),isNaN(u))return new Date(NaN)}else{var m=new Date(d+i),p=new Date(0);return p.setFullYear(m.getUTCFullYear(),m.getUTCMonth(),m.getUTCDate()),p.setHours(m.getUTCHours(),m.getUTCMinutes(),m.getUTCSeconds(),m.getUTCMilliseconds()),p}return new Date(d+i+u)}var k={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},We=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Ye=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Ne=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Ce(e){var t={},r=e.split(k.dateTimeDelimiter),a;if(r.length>2)return t;if(/:/.test(r[0])?a=r[0]:(t.date=r[0],a=r[1],k.timeZoneDelimiter.test(t.date)&&(t.date=e.split(k.timeZoneDelimiter)[0],a=e.substr(t.date.length,e.length))),a){var s=k.timezone.exec(a);s?(t.time=a.replace(s[1],""),t.timezone=s[1]):t.time=a}return t}function we(e,t){var r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),a=e.match(r);if(!a)return{year:NaN,restDateString:""};var s=a[1]?parseInt(a[1]):null,o=a[2]?parseInt(a[2]):null;return{year:o===null?s:o*100,restDateString:e.slice((a[1]||a[2]).length)}}function Ee(e,t){if(t===null)return new Date(NaN);var r=e.match(We);if(!r)return new Date(NaN);var a=!!r[4],s=h(r[1]),o=h(r[2])-1,n=h(r[3]),d=h(r[4]),i=h(r[5])-1;if(a)return Qe(t,d,i)?Le(t,d,i):new Date(NaN);var u=new Date(0);return!Ae(t,o,n)||!Ve(t,s)?new Date(NaN):(u.setUTCFullYear(t,o,Math.max(s,n)),u)}function h(e){return e?parseInt(e):1}function He(e){var t=e.match(Ye);if(!t)return NaN;var r=H(t[1]),a=H(t[2]),s=H(t[3]);return Pe(r,a,s)?r*w+a*C+s*1e3:NaN}function H(e){return e&&parseFloat(e.replace(",","."))||0}function qe(e){if(e==="Z")return 0;var t=e.match(Ne);if(!t)return 0;var r=t[1]==="+"?-1:1,a=parseInt(t[2]),s=t[3]&&parseInt(t[3])||0;return Ue(a,s)?r*(a*w+s*C):NaN}function Le(e,t,r){var a=new Date(0);a.setUTCFullYear(e,0,4);var s=a.getUTCDay()||7,o=(t-1)*7+r+1-s;return a.setUTCDate(a.getUTCDate()+o),a}var Fe=[31,null,31,30,31,30,31,31,30,31,30,31];function Z(e){return e%400==0||e%4==0&&e%100!=0}function Ae(e,t,r){return t>=0&&t<=11&&r>=1&&r<=(Fe[t]||(Z(e)?29:28))}function Ve(e,t){return t>=1&&t<=(Z(e)?366:365)}function Qe(e,t,r){return t>=1&&t<=53&&r>=0&&r<=6}function Pe(e,t,r){return e===24?t===0&&r===0:r>=0&&r<60&&t>=0&&t<60&&e>=0&&e<25}function Ue(e,t){return t>=0&&t<=59}function G(){let e=y(),t={videoId:e,timestamp:new Date};e&&f.emit("startSync",t)}function K(e){let t=l.getCurrentTime(),r=new Date,a=b(e),s=M(r,a),o=s-t;console.log({sync:s,currentPosition:t}),(o>1||o<-1)&&l.seekTo(s,!0)}function Re(){f.on("updateClubState",P),f.on("queueNext",B),f.on("memberLeft",I),f.on("addToPlaylist",Q),f.on("syncTrack",K),console.log("Initialized socket listeners"),f.emit("setupClub")}var X=Re;function _e(){let e=JSON.parse(localStorage.getItem("user"));return e||c("No user logged in"),e}var W=_e;var fr=W(),l;function $e(){let e=y(),t={height:"300",width:"500",videoId:e,playerVars:{cc_load_policy:0,controls:0,disablekb:1,enablejsapi:1,fs:0,modestbranding:1,autoplay:1},events:{onReady:Be,onStateChange:ze,onError:Je}};l=new YT.Player("player",t)}function Be(e){e.target.setVolume(100),console.log("Initialized youtube player"),X()}function ze(e){if(e.data===YT.PlayerState.ENDED){console.log("Load next video");let t=y();f.emit("queueNext",{videoId:t})}e.data===YT.PlayerState.PLAYING&&G()}function Je(e){f.emit("queueNext"),c(`Error loading video. code ${e.data}`)}var ee=$e;var q=W(),f;function Ze(){f=io(`/${q.clubId}`,{query:{userId:q._id,clubId:q.clubId}}),f.on("connect",()=>{console.log("Club socket connected"),ee()})}var te=Ze;function Ge(e){let t=new DocumentFragment,r=document.createElement("ul");return r.className="main--result-list",e.items.forEach(a=>{let s=document.createElement("li"),o=document.createElement("button");o.className="btn--result";let n=document.createElement("span"),d=document.createTextNode(a.snippet.title);n.appendChild(d);let i=document.createElement("img");i.setAttribute("src",a.snippet.thumbnails.default.url),i.className="thumbnail",o.appendChild(n),o.appendChild(i),s.appendChild(o),r.appendChild(s),T(o,a.snippet.title,a.id.videoId)}),t.append(r),t}var re=Ge;async function Ke(e){e.preventDefault();let t=L.formData(),r=await S.search(t),a=document.querySelector(".main--search-results");a.innerText="";let s=re(r.results);a.appendChild(s)}var ae=Ke;var L=new V;window.onload=()=>{let e=document.querySelector(".main--search");L.init(e),e.addEventListener("submit",ae),O(),te()};})();
//# sourceMappingURL=index.js.map
