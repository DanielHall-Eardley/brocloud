(()=>{var p="https://bro-cloud.herokuapp.com",T=class{constructor(){this.state={}}updateState(t){let n=t.target.name,o=t.target.value;this.state[n]=o}init(t){let n=t.children;for(let o of n)(o.nodeName==="INPUT"||o.nodeName==="SELECT")&&o.addEventListener("input",this.updateState.bind(this))}formData(){return this.state}},h={error:null,updateError(e){this.error=e;let t=document.querySelector(".error"),n=document.createTextNode(e);t.appendChild(n)},getError(){return this.error}};var v=JSON.parse(localStorage.getItem("user")),y={headers:{"Content-Type":"application/json"},method:"POST"},N=async(e,t,n)=>{if(v){let{clubId:a,_id:r}=v;y.headers.Authorization=`${r} ${a}`}t&&(y.body=JSON.stringify(t)),n&&(y.method=n);let o=await fetch(p+e,y);if(o.status>=200&&o.status<=299){let a=await o.json();return Promise.resolve(a)}h.updateError(o.error)},S={signup:async e=>{let t=await N("/signup",e);return Promise.resolve(t)},search:async e=>{let t=await N("/search",e);return Promise.resolve(t)},addVideo:async e=>{let t=await N("/addVideo",e);return Promise.resolve(t)}};var I=new T,b,C,s,E,l=JSON.parse(localStorage.getItem("user"));window.onload=()=>{let e=document.querySelector(".main--search");I.init(e),e.addEventListener("submit",A),k(),C=io(p),C.on("connect",()=>{console.log("Socket connected"),C.emit("setUpNs",l.clubId)}),s=io(`/${l.clubId}`),s.on("connect",()=>{console.log("Club NS socket connected"),V(),w()})};function V(){s.emit("setUpClub",l._id)}function w(){s.on("updateClubState",B),s.on("updatePlaylist",L)}function B(e){let t=l.clubId,n=document.querySelector("#videoId");if(!n){s.emit("playNext",t);return}console.log(e),D(n.value,e.ellapsedSeconds,e.member[0]),F(e.members)}function U(e,t){E=setInterval(()=>{let n={seconds:e.getCurrentTime(),clubId:t};s.emit("updateSync",n)},500)}function k(){let t=document.querySelector(".main--history-list").getElementsByTagName("li");for(let n of t){let o=n.getAttribute("id"),a=n.getElementsByTagName("button")[0],r=a.getElementsByTagName("p")[0].innerText;x(a,null,r,o)}}function F(e){let n=document.querySelector(".main--squad-list").getElementsByTagName("li");e.forEach(o=>{for(let a of n)if(a.id.toString()===o.toString()){let r=a.getElementsByTagName("span");r[1].className="u--green-circle"}})}function D(e,t,n){b=new YT.Player("player",{height:"300",width:"500",videoId:e,playerVars:{cc_load_policy:0,controls:0,disablekb:1,enablejsapi:1,fs:0,modestbranding:1},events:{onReady:o=>{Y(o,t)},onStateChange:o=>{j(o,n)},onError:_}})}function Y(e,t){e.target.setVolume(100),e.target.seekTo(t,!0)}async function A(e){e.preventDefault();let t=I.formData(),n=await S.search(t),o=document.querySelector(".main--search-results");o.innerText="";let a=O(n.results);o.appendChild(a)}function x(e,t,n,o){e.addEventListener("click",async a=>{t&&(t.innerText="");let r={name:n,videoId:o},d=await S.addVideo(r);R(d)})}function O(e){let t=new DocumentFragment,n=document.createElement("ul");return n.className="main--result-list",e.items.forEach(o=>{let a=document.createElement("li"),r=document.createElement("button");r.className="btn--result",x(r,n,o.snippet.title,o.id.videoId);let d=document.createElement("span"),c=document.createTextNode(o.snippet.title);d.appendChild(c);let i=document.createElement("img");i.setAttribute("src",o.snippet.thumbnails.default.url),i.className="thumbnail",r.appendChild(d),r.appendChild(i),a.appendChild(r),n.appendChild(a)}),t.append(n),t}function R(e){let{currentlyPlaying:t,queuedVideo:n,ellapsedSeconds:o}=e;if(!n&&t.videoId){let a=document.querySelector(".main--playing");a.getElementsByTagName("li")[0]&&(a.innerText="");let d=document.createTextNode(t.name),c=document.createTextNode(t.userFullName),i=document.createElement("li"),m=document.createElement("div"),u=document.createElement("input");u.setAttribute("value",t.videoId),u.setAttribute("id","videoId"),u.setAttribute("type","hidden"),m.className="main--name-highlight",m.appendChild(c),i.appendChild(d),i.appendChild(m),i.appendChild(u),a.appendChild(i),b.loadVideoById(t.videoId,o)}if(n){let a=document.querySelector(".main--up-next"),r=document.createTextNode(n.name),d=document.createTextNode(n.userFullName),c=document.createElement("li"),i=document.createElement("div");i.className="main--name-highlight",i.appendChild(d),c.appendChild(r),c.appendChild(i),a.appendChild(c)}}function L(e){if(e.empty)return clearInterval(E);let{currentlyPlaying:t,playlist:n,ellapsedSeconds:o}=e,a=document.querySelector(".main--playing");a.innerText="";let r=document.createTextNode(t.name),d=document.createTextNode(t.userFullName),c=document.createElement("li"),i=document.createElement("div");i.className="main--name-highlight",i.appendChild(d),c.appendChild(r),c.appendChild(i),a.appendChild(c),b.loadVideoById(a.videoId,o);let m=document.querySelector(".main--up-next");m.innerText="",n.forEach(u=>{let P=document.createTextNode(u.name),q=document.createTextNode(u.userFullName),g=document.createElement("li"),f=document.createElement("div");f.className="main--name-highlight",f.appendChild(q),g.appendChild(P),g.appendChild(f),m.appendChild(g)})}async function j(e,t){let o=document.querySelector(".main--up-next").getElementsByTagName("li").length;e.data===YT.PlayerState.ENDED&&o>0&&(s.emit("playNext",l.clubId),clearInterval(E)),e.data===YT.PlayerState.PAUSED&&o>0&&e.target.playVideo(),e.data===YT.PlayerState.PLAYING&&o>0&&l._id===t&&U(e.target,l.clubId)}function _(e){h.updateError(`Error loading video. code ${e.data}`),s.emit("playNext",l.clubId)}})();
//# sourceMappingURL=index.js.map
