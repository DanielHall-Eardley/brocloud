(()=>{var le=Object.create;var N=Object.defineProperty;var me=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var xe=Object.getPrototypeOf,pe=Object.prototype.hasOwnProperty;var je=e=>N(e,"__esModule",{value:!0});var Q=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ye=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of ce(t))!pe.call(e,a)&&a!=="default"&&N(e,a,{get:()=>t[a],enumerable:!(r=me(t,a))||r.enumerable});return e},Y=e=>ye(je(N(e!=null?le(xe(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var C=Q($=>{function ge(e,t){if(!t)return e;let r=Object.keys(t);return r.length>0&&r.forEach(a=>{let s=t[a];e.setAttribute(a,s)}),e}function Ie(e,t){if(t){let r=document.createTextNode(t);e.appendChild(r)}return e}$.createHTMLComponent=function(e){let t=new DocumentFragment;function r(a,s){a.forEach(o=>{let{name:n,attributes:d,content:i,children:u}=o,l=document.createElement(n),p=ge(l,d),V=Ie(p,i);s.append(V),u&&u.length>0&&r(u,V)})}return r(e,t),t}});var z=Q((lt,B)=>{var R=Y(C());function Te(e){let t=[{name:"li",attributes:{id:e._id},children:[{name:"span",content:`${e.firstName} "${e.nickName}" ${e.lastName}`},{name:"span",attributes:{class:"u--green-circle"}}]}];return(0,R.createHTMLComponent)(t)}B.exports=Te});var w="https://brocloud.ca",U=class{constructor(t=null){this.state={},this.customFn=t}updateState(t,r){this.state[t]=r}eventListener(t){let r=t.target.name,a=t.target.value;this.updateState.apply(this,[r,a])}init(t){let r=t.children;for(let a of r)(a.nodeName==="INPUT"||a.nodeName==="SELECT")&&a.addEventListener("input",this.eventListener.bind(this))}formData(){return this.state}},g=e=>{let t=document.querySelector(".error"),r=document.createTextNode(`${e.message}. Status: ${e.status}`);t.appendChild(r),setTimeout(()=>{t.innerText=""},2e4)};var P=()=>{window.location.replace(`${w}/login`)};function he(e){let t=e.video,r=document.querySelector(".main--up-next"),a=r.getElementsByTagName("li").length,s=document.createTextNode(t.name),o=document.createTextNode(t.userFullName),n=document.createElement("li");n.setAttribute("id",t._id);let d=document.createElement("div");d.className="main--name-highlight",d.appendChild(o);let i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("value",t.videoId),a===0?i.setAttribute("id","current-video"):i.setAttribute("class","next-video"),n.appendChild(i),n.appendChild(s),n.appendChild(d),r.appendChild(n),a===0&&c.loadVideoById(t.videoId)}var _=he;var J=Y(z());function Se(){return JSON.parse(localStorage.getItem("user"))}var x=Se;function Oe(e,t){let r=t.getElementsByTagName("span")[1];e.active?r.className="u--green-circle":r.className="u--red-circle"}function ve(e){if(x()._id.toString()!==e._id.toString()){let r=document.getElementById(e._id);if(r)Oe(e,r);else{let a=document.querySelector(".main--squad-list"),s=(0,J.default)(e);a.appendChild(s)}}}var Z=ve;var v=Y(C());var G=JSON.parse(localStorage.getItem("user")),I={headers:{"Content-Type":"application/json"},method:"POST"},j=async(e,t,r)=>{if(G){let{clubId:o,_id:n}=G;I.headers.Authorization=`${n} ${o}`}t&&(I.body=JSON.stringify(t)),r&&(I.method=r);let a=await fetch(w+e,I),s=await a.json();if(a.status>=200&&a.status<=299)return Promise.resolve(s);g(s)},T={signupJoin:async(e,t)=>{let r=await j(`/signup/join/${t}`,e);return Promise.resolve(r)},signupCreate:async(e,t)=>{let r=await j(`/signup/create/${t}`,e);return Promise.resolve(r)},search:async e=>{let t=await j("/youtube-api/search",e);return Promise.resolve(t)},addVideo:async e=>{let t=await j("/music/addVideo",e);return Promise.resolve(t)},login:async e=>{let t=await j("/login",e);return Promise.resolve(t)}};async function De(e,t,r){e.addEventListener("click",async a=>{let s={name:t,videoId:r};await T.addVideo(s);let o=document.querySelector(".main--result-list");if(o){o.innerHTML="";let n=document.querySelector(".main--search-input");n.value=""}})}var S=De;function Me(e){let t=e.querySelector(".played-video");if(t){let r=t.value,a=e.getElementsByTagName("button")[0],s=a.querySelector(".played-video--name").innerText;S(a,s,r)}}var K=Me;function be(){let t=document.querySelector(".main--history-list").getElementsByTagName("li");if(t.length>0)for(let r of t)K(r)}var O=be;function ke(e){return[{name:"li",attributes:{id:e._id},content:e.name,children:[{name:"input",attributes:{type:"hidden",class:"next-video",value:e.videoId}},{name:"div",content:e.userFullName,attributes:{class:"main--name-highlight",value:e.videoId}}]}]}function We(e){return[{name:"li",attributes:{id:e._id},content:e.name,children:[{name:"input",attributes:{type:"hidden",id:"current-video",value:e.videoId}},{name:"div",content:e.userFullName,attributes:{class:"main--name-highlight",value:e.videoId}}]}]}function Ne(e){return[{name:"li",attributes:{id:e._id},children:[{name:"input",attributes:{type:"hidden",class:"played-video",value:e.videoId}},{name:"button",attributes:{class:"btn--result btn--history"},children:[{name:"p",attributes:{class:"played-video--name"},content:e.name},{name:"p",content:e.userFullName,children:[{name:"span",attributes:{class:"main--timestamp"},content:` | ${e.playedAtTime}`}]}]}]}]}function Ye(e){let{upNext:t,history:r}=e,a=e.upNext[0],s=document.querySelector(".main--up-next"),o=document.querySelector(".main--history-list");s.innerHTML="",o.innerHTML="",a&&(c.loadVideoById(a.videoId),t.forEach((n,d)=>{if(d===0){let i=(0,v.createHTMLComponent)(We(n));s.append(i)}else{let i=(0,v.createHTMLComponent)(ke(n));s.append(i)}})),r.forEach(n=>{let d=(0,v.createHTMLComponent)(Ne(n));o.append(d)}),O()}var X=Ye;function we(e){let r=document.querySelector(".main--squad-list").getElementsByTagName("li");for(let a of r){let s=a.getElementsByTagName("span")[1],o=a.id;e.toString()===o.toString()&&(s.className="u--red-circle")}}var ee=we;function Ce(){let e=document.querySelector("#current-video");return e?e.getAttribute("value"):!1}var y=Ce;function E(e){if(e===null||e===!0||e===!1)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function m(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function D(e){m(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console!="undefined"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn(new Error().stack)),new Date(NaN))}var Ee=Math.pow(10,8)*24*60*60*1e3,H=6e4,L=36e5;var wt=-Ee;function q(e,t){return m(2,arguments),D(e).getTime()-D(t).getTime()}var te={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)}},He="trunc";function re(e){return e?te[e]:te[He]}function M(e,t,r){m(2,arguments);var a=q(e,t)/1e3;return re(r==null?void 0:r.roundingMethod)(a)}function b(e,t){m(1,arguments);var r=t||{},a=r.additionalDigits==null?2:E(r.additionalDigits);if(a!==2&&a!==1&&a!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var s=Fe(e),o;if(s.date){var n=Ve(s.date,a);o=Qe(n.restDateString,n.year)}if(!o||isNaN(o.getTime()))return new Date(NaN);var d=o.getTime(),i=0,u;if(s.time&&(i=Ue(s.time),isNaN(i)))return new Date(NaN);if(s.timezone){if(u=Pe(s.timezone),isNaN(u))return new Date(NaN)}else{var l=new Date(d+i),p=new Date(0);return p.setFullYear(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()),p.setHours(l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds()),p}return new Date(d+i+u)}var k={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Le=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,qe=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Ae=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Fe(e){var t={},r=e.split(k.dateTimeDelimiter),a;if(r.length>2)return t;if(/:/.test(r[0])?a=r[0]:(t.date=r[0],a=r[1],k.timeZoneDelimiter.test(t.date)&&(t.date=e.split(k.timeZoneDelimiter)[0],a=e.substr(t.date.length,e.length))),a){var s=k.timezone.exec(a);s?(t.time=a.replace(s[1],""),t.timezone=s[1]):t.time=a}return t}function Ve(e,t){var r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),a=e.match(r);if(!a)return{year:NaN,restDateString:""};var s=a[1]?parseInt(a[1]):null,o=a[2]?parseInt(a[2]):null;return{year:o===null?s:o*100,restDateString:e.slice((a[1]||a[2]).length)}}function Qe(e,t){if(t===null)return new Date(NaN);var r=e.match(Le);if(!r)return new Date(NaN);var a=!!r[4],s=h(r[1]),o=h(r[2])-1,n=h(r[3]),d=h(r[4]),i=h(r[5])-1;if(a)return ze(t,d,i)?_e(t,d,i):new Date(NaN);var u=new Date(0);return!Re(t,o,n)||!Be(t,s)?new Date(NaN):(u.setUTCFullYear(t,o,Math.max(s,n)),u)}function h(e){return e?parseInt(e):1}function Ue(e){var t=e.match(qe);if(!t)return NaN;var r=A(t[1]),a=A(t[2]),s=A(t[3]);return Je(r,a,s)?r*L+a*H+s*1e3:NaN}function A(e){return e&&parseFloat(e.replace(",","."))||0}function Pe(e){if(e==="Z")return 0;var t=e.match(Ae);if(!t)return 0;var r=t[1]==="+"?-1:1,a=parseInt(t[2]),s=t[3]&&parseInt(t[3])||0;return Ze(a,s)?r*(a*L+s*H):NaN}function _e(e,t,r){var a=new Date(0);a.setUTCFullYear(e,0,4);var s=a.getUTCDay()||7,o=(t-1)*7+r+1-s;return a.setUTCDate(a.getUTCDate()+o),a}var $e=[31,null,31,30,31,30,31,31,30,31,30,31];function ae(e){return e%400==0||e%4==0&&e%100!=0}function Re(e,t,r){return t>=0&&t<=11&&r>=1&&r<=($e[t]||(ae(e)?29:28))}function Be(e,t){return t>=1&&t<=(ae(e)?366:365)}function ze(e,t,r){return t>=1&&t<=53&&r>=0&&r<=6}function Je(e,t,r){return e===24?t===0&&r===0:r>=0&&r<60&&t>=0&&t<60&&e>=0&&e<25}function Ze(e,t){return t>=0&&t<=59}function se(){let e=y(),t={videoId:e,timestamp:new Date};e&&f.emit("startSync",t)}function oe(e){let t=c.getCurrentTime(),r=new Date,a=b(e),s=M(r,a),o=s-t;console.log({ellapsedTime:s,currentPosition:t}),(o>1||o<1)&&c.seekTo(s,!0)}function Ge(){f.on("updateActiveMember",Z),f.on("queueNext",X),f.on("memberLeft",ee),f.on("addToPlaylist",_),f.on("syncTrack",oe),console.log("Initialized socket listeners")}var ne=Ge;var xr=x(),c;function Ke(){let e=y(),t={height:"300",width:"500",videoId:e,playerVars:{cc_load_policy:0,controls:0,disablekb:1,enablejsapi:1,fs:0,modestbranding:1,autoplay:1},events:{onReady:Xe,onStateChange:et,onError:tt}};c=new YT.Player("player",t)}function Xe(e){e.target.setVolume(100),console.log("Initialized youtube player"),ne()}function et(e){if(e.data===YT.PlayerState.ENDED){console.log("Load next video");let t=y();f.emit("queueNext",{videoId:t})}e.data===YT.PlayerState.PLAYING&&se()}function tt(e){f.emit("queueNext"),g(`Error loading video. code ${e.data}`)}var ie=Ke;var W=x(),f;function rt(){W?(f=io(`/${W.clubId}`,{query:{userId:W._id,clubId:W.clubId}}),f.on("connect",()=>{console.log("Club socket connected"),ie()})):P()}var de=rt;function at(e){let t=new DocumentFragment,r=document.createElement("ul");return r.className="main--result-list",e.items.forEach(a=>{let s=document.createElement("li"),o=document.createElement("button");o.className="btn--result";let n=document.createElement("span"),d=document.createTextNode(a.snippet.title);n.appendChild(d);let i=document.createElement("img");i.setAttribute("src",a.snippet.thumbnails.default.url),i.className="thumbnail",o.appendChild(n),o.appendChild(i),s.appendChild(o),r.appendChild(s),S(o,a.snippet.title,a.id.videoId)}),t.append(r),t}var fe=at;async function st(e){e.preventDefault();let t=F.formData(),r=await T.search(t),a=document.querySelector(".main--search-results");a.innerText="";let s=fe(r.results);a.appendChild(s)}var ue=st;var F=new U;window.onload=()=>{let e=document.querySelector(".main--search");F.init(e),e.addEventListener("submit",ue),O(),de()};})();
//# sourceMappingURL=index.js.map
