(()=>{var L="https://bro-cloud.herokuapp.com",k=class{constructor(t=null){this.state={},this.customFn=t}updateState(t,o){this.state[t]=o}eventListener(t){let o=t.target.name,n=t.target.value,r=t.target.innerText;this.updateState.apply(this,[o,n]),this.customFn&&this.customFn({key:o,value:n,innerText:r},this.state)}init(t,o){let n=t.children;for(let r of n)(r.nodeName==="INPUT"||r.nodeName==="SELECT")&&r.addEventListener("input",this.eventListener.bind(this));if(o){let{identifier:r,childElementType:i,eventType:s}=o,a=document.querySelector(r).getElementsByTagName(i);for(let p of a)p.addEventListener(s,this.eventListener.bind(this))}}formData(){return this.state}},m=e=>{let t=document.querySelector(".error"),o=document.createTextNode(e);t.appendChild(o),setTimeout(()=>{t.innerText=""},2e4)};function J(e){let t=e.video,o=document.querySelector(".main--up-next"),n=o.getElementsByTagName("li").length;n===0&&l.loadVideoById(t.videoId);let r=document.createTextNode(t.name),i=document.createTextNode(t.userFullName),s=document.createElement("li");s.setAttribute("id",t._id);let c=document.createElement("div");c.className="main--name-highlight";let a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("value",t.videoId),n===0?a.setAttribute("id","current-video"):a.setAttribute("class","next-video"),c.appendChild(i),s.appendChild(r),s.appendChild(c),o.appendChild(s)}var q=J;function G(e){let o=document.querySelector(".main--squad-list").getElementsByTagName("li");e.forEach(n=>{for(let r of o)if(r.id.toString()===n.toString()){let i=r.getElementsByTagName("span");i[1].className="u--green-circle"}})}var f=G;var v;function K(e){console.log(e),v=e,document.querySelector("#current-video")&&l.seekTo(e.ellapsedSeconds,!0),f(e.members)}var P=K;function Q(e){console.log(e);let{newVideo:t,previousVideo:o}=e;t&&l.loadVideoById(t.videoId);let n=document.querySelector(".main--up-next"),r=document.querySelector(".main--history-list"),i=n.getElementsByTagName("li");for(let s of i)if(s.getAttribute("id").toString()==o._id.toString()){n.removeChild(s),s.innerText="";let c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("class","played-video"),c.setAttribute("value",o.videoId);let a=document.createElement("button");a.setAttribute("class","btn--result btn--history");let p=document.createElement("p");p.setAttribute("class","played-video--name");let O=document.createTextNode(o.name);p.appendChild(O);let S=document.createElement("p"),z=document.createTextNode(`${o.userFullName} | `);S.appendChild(z);let T=document.createElement("span");T.setAttribute("class","main--timestamp");let H=document.createTextNode(o.playedAtTime);T.appendChild(H),S.appendChild(T),a.appendChild(p),a.appendChild(S),s.appendChild(c),s.appendChild(a),r.prepend(s)}}var A=Q;function W(){let e=JSON.parse(localStorage.getItem("user"));return e||m("No user logged in"),e}var u=W;var x=u(),V,N=!1,y=0;function w(){if(v.members[0].toString()===x._id.toString())X();else if(!N){let t=l.getCurrentTime();(y>t||y<t)&&(l.seekTo(y,!0),N=!0)}}function E(){clearInterval(V),N=!1}function X(){V=setInterval(()=>{let e={currentPosition:l.getCurrentTime(),clubId:x.clubId,userId:x._id};d.emit("updateSync",e)},500)}function U(e){y=e}var F=u();function Z(){let e={userId:F._id,clubId:F.clubId};d.on("updateClubState",P),d.on("queueNext",A),d.on("memberLeft",f),d.on("addToPlaylist",q),window.addEventListener("unload",function(){console.log("closing page"),d.emit("pageClose",e)}),d.on("syncTrack",U),console.log("Initialized socket listeners"),d.emit("setupClub",e)}var B=Z;var M=u(),l;function ne(){let e={height:"300",width:"500",playerVars:{cc_load_policy:0,disablekb:1,enablejsapi:1,fs:0,modestbranding:1},events:{onReady:ee,onStateChange:te,onError:oe}},t=document.querySelector("#current-video");t&&(e.videoId=t.getAttribute("value")),l=new YT.Player("player",e)}function ee(e){e.target.setVolume(100),console.log("Initialized youtube player"),B()}function te(e){e.data===YT.PlayerState.ENDED&&(console.log("Load next video"),d.emit("queueNext",{clubId:M.clubId}),E()),e.data===YT.PlayerState.PLAYING&&w()}function oe(e){d.emit("queueNext",M.clubId),m(`Error loading video. code ${e.data}`),E()}var _=ne;var re=u(),d;function ie(){d=io(`/${re.clubId}`),d.on("connect",()=>{console.log("Club socket connected"),_()})}var D=ie;var R=JSON.parse(localStorage.getItem("user")),h={headers:{"Content-Type":"application/json"},method:"POST"},I=async(e,t,o)=>{if(R){let{clubId:r,_id:i}=R;h.headers.Authorization=`${i} ${r}`}t&&(h.body=JSON.stringify(t)),o&&(h.method=o);let n=await fetch(L+e,h);if(n.status>=200&&n.status<=299){let r=await n.json();return Promise.resolve(r)}m(n.error)},b={signup:async e=>{let t=await I(`/signup/${e.url}`,e.body);return Promise.resolve(t)},search:async e=>{let t=await I("/search",e);return Promise.resolve(t)},addVideo:async e=>{let t=await I("/addVideo",e);return Promise.resolve(t)}};function se(e,t,o,n){e.addEventListener("click",async r=>{t&&(t.innerText="");let i={name:o,videoId:n};await b.addVideo(i)})}var g=se;function ae(){let t=document.querySelector(".main--history-list").getElementsByTagName("li");for(let o of t){let n=o.querySelector(".played-video").value,r=o.getElementsByTagName("button")[0],i=r.querySelector(".played-video--name").innerText;g(r,null,i,n)}}var Y=ae;function de(e){let t=new DocumentFragment,o=document.createElement("ul");return o.className="main--result-list",e.items.forEach(n=>{let r=document.createElement("li"),i=document.createElement("button");i.className="btn--result",g(i,o,n.snippet.title,n.id.videoId);let s=document.createElement("span"),c=document.createTextNode(n.snippet.title);s.appendChild(c);let a=document.createElement("img");a.setAttribute("src",n.snippet.thumbnails.default.url),a.className="thumbnail",i.appendChild(s),i.appendChild(a),r.appendChild(i),o.appendChild(r)}),t.append(o),t}var $=de;async function ce(e){e.preventDefault();let t=C.formData(),o=await b.search(t),n=document.querySelector(".main--search-results");n.innerText="";let r=$(o.results);n.appendChild(r)}var j=ce;var C=new k;window.onload=()=>{let e=document.querySelector(".main--search");C.init(e),e.addEventListener("submit",j),Y(),D()};})();
//# sourceMappingURL=index.js.map
