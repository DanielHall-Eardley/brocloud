(()=>{var I="http://localhost:3000",E=class{constructor(t=null){this.state={},this.customFn=t}updateState(t,o){this.state[t]=o}eventListener(t){let o=t.target.name,n=t.target.value,r=t.target.innerText;this.updateState.apply(this,[o,n]),this.customFn&&this.customFn({key:o,value:n,innerText:r},this.state)}init(t,o){let n=t.children;for(let r of n)(r.nodeName==="INPUT"||r.nodeName==="SELECT")&&r.addEventListener("input",this.eventListener.bind(this));if(o){let{identifier:r,childElementType:i,eventType:s}=o,c=document.querySelector(r).getElementsByTagName(i);for(let Y of c)Y.addEventListener(s,this.eventListener.bind(this))}}formData(){return this.state}},m=e=>{let t=document.querySelector(".error"),o=document.createTextNode(e);t.appendChild(o),setTimeout(()=>{t.innerText=""},2e4)};function j(e){let t=e.video,o=document.querySelector(".main--up-next"),n=o.getElementsByTagName("li").length,r=document.createTextNode(t.name),i=document.createTextNode(t.userFullName),s=document.createElement("li");s.setAttribute("id",t._id);let u=document.createElement("div");u.className="main--name-highlight";let c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("value",t.videoId),n===0?c.setAttribute("id","current-video"):c.setAttribute("class","next-video"),u.appendChild(i),s.appendChild(r),s.appendChild(u),o.appendChild(s)}var C=j;function $(e){let o=document.querySelector(".main--squad-list").getElementsByTagName("li");e.forEach(n=>{for(let r of o)if(r.id.toString()===n.toString()){let i=r.getElementsByTagName("span");i[1].className="u--green-circle"}})}var p=$;var b;function O(e){console.log(e),b=e,document.querySelector("#current-video")&&d.seekTo(e.ellapsedSeconds,!0),p(e.members)}var L=O;function z(e){let{nextVideo:t,previousVideoId:o}=e;t&&d.loadVideoById(t.videoId);let n=document.querySelector(".main--up-next"),r=document.querySelector(".main--history-list"),i=n.getElementsByTagName("li");for(let s of i)i.id.toString()==o.toString()&&(r.prependChild(s),n.removeChild(s))}var k=z;function H(){let e=JSON.parse(localStorage.getItem("user"));return e||m("No user logged in"),e}var l=H;var S=l(),q,v=!1,f=0;function P(){if(b.members[0].toString()===S._id.toString())J();else if(!v){let t=d.getCurrentTime();(f>t||f<t)&&(d.seekTo(f,!0),v=!0)}}function T(){clearInterval(q),v=!1}function J(){q=setInterval(()=>{let e={currentPosition:d.getCurrentTime(),clubId:S.clubId,userId:S._id};a.emit("updateSync",e)},500)}function V(e){f=e}var w=l();function G(){let e={userId:w._id,clubId:w.clubId};a.on("updateClubState",L),a.on("queueNext",k),a.on("memberLeft",p),a.on("addToPlaylist",C),window.addEventListener("unload",function(){console.log("closing page"),a.emit("pageClose",e)}),a.on("syncTrack",V),console.log("Initialized socket listeners"),a.emit("setupClub",e)}var A=G;var U=l(),d;function X(){let e={height:"300",width:"500",playerVars:{cc_load_policy:0,controls:0,disablekb:1,enablejsapi:1,fs:0,modestbranding:1},events:{onReady:K,onStateChange:Q,onError:W}},t=document.querySelector("#current-video");t&&(e.videoId=t.getAttribute("value")),d=new YT.Player("player",e)}function K(e){e.target.setVolume(100),console.log("Initialized youtube player"),A()}function Q(e){e.data===YT.PlayerState.ENDED&&(console.log("Load next video"),clubSocket.emit("queueNext",{clubId:U.clubId}),T()),e.data===YT.PlayerState.PLAYING&&P()}function W(e){clubSocket.emit("queueNext",U.clubId),m(`Error loading video. code ${e.data}`),T()}var F=X;var Z=l(),a;function ee(){a=io(`/${Z.clubId}`),a.on("connect",()=>{console.log("Club socket connected"),F()})}var B=ee;var M=JSON.parse(localStorage.getItem("user")),y={headers:{"Content-Type":"application/json"},method:"POST"},x=async(e,t,o)=>{if(M){let{clubId:r,_id:i}=M;y.headers.Authorization=`${i} ${r}`}t&&(y.body=JSON.stringify(t)),o&&(y.method=o);let n=await fetch(I+e,y);if(n.status>=200&&n.status<=299){let r=await n.json();return Promise.resolve(r)}m(n.error)},g={signup:async e=>{let t=await x(`/signup/${e.url}`,e.body);return Promise.resolve(t)},search:async e=>{let t=await x("/search",e);return Promise.resolve(t)},addVideo:async e=>{let t=await x("/addVideo",e);return Promise.resolve(t)}};function te(e,t,o,n){e.addEventListener("click",async r=>{t&&(t.innerText="");let i={name:o,videoId:n};await g.addVideo(i)})}var h=te;function oe(){let t=document.querySelector(".main--history-list").getElementsByTagName("li");for(let o of t){let n=o.querySelector(".played-video").value,r=o.getElementsByTagName("button")[0],i=r.querySelector(".played-video--name").innerText;h(r,null,i,n)}}var _=oe;function ne(e){let t=new DocumentFragment,o=document.createElement("ul");return o.className="main--result-list",e.items.forEach(n=>{let r=document.createElement("li"),i=document.createElement("button");i.className="btn--result",h(i,o,n.snippet.title,n.id.videoId);let s=document.createElement("span"),u=document.createTextNode(n.snippet.title);s.appendChild(u);let c=document.createElement("img");c.setAttribute("src",n.snippet.thumbnails.default.url),c.className="thumbnail",i.appendChild(s),i.appendChild(c),r.appendChild(i),o.appendChild(r)}),t.append(o),t}var D=ne;async function re(e){e.preventDefault();let t=N.formData(),o=await g.search(t),n=document.querySelector(".main--search-results");n.innerText="";let r=D(o.results);n.appendChild(r)}var R=re;var N=new E;window.onload=()=>{let e=document.querySelector(".main--search");N.init(e),e.addEventListener("submit",R),_(),B()};})();
//# sourceMappingURL=index.js.map
