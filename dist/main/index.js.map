{
  "version": 3,
  "sources": ["../../static/common/global.js", "../../static/common/api.js", "../../static/main/index.js"],
  "sourcesContent": ["// export const host = 'http://localhost:3000';\nexport const host = 'https://bro-cloud.herokuapp.com';\n\nexport const FormState = class FormState {\n  constructor () {\n    this.state = {}\n  }\n\n  updateState(event) {\n    const key = event.target.name;\n    const value = event.target.value;\n    this.state[key] = value;\n  }\n\n  init(form) {\n    const elements = form.children;\n    for (let element of elements) {\n      if (\n        element.nodeName === 'INPUT' \n        || element.nodeName === 'SELECT'\n      ) {\n        element.addEventListener('input', this.updateState.bind(this))\n      }\n    };\n  }\n\n  formData() {\n    return this.state;\n  }\n}\n\nexport const errorState = {\n  error: null,\n  updateError(error) {\n    this.error = error\n    const errorNotif = document.querySelector('.error');\n    const errorMessage = document.createTextNode(error);\n    errorNotif.appendChild(errorMessage)\n\n    setTimeout(() => {\n      errorNotif.innerText = ''\n    }, 20000)\n  },\n  getError() {\n    return this.error\n  }\n};\n", "import { host, errorState } from './global.js';\nconst user = JSON.parse(localStorage.getItem('user'))\n\nconst options = {\n  headers: {\n    'Content-Type': 'application/json',\n  },\n  method: 'POST',\n}\n\nconst request = async (url, body, method) => {\n  if (user) {\n    const { clubId, _id } = user;\n    options.headers.Authorization = `${_id} ${clubId}`;\n  }\n\n  if (body) {\n    options.body = JSON.stringify(body);\n  }\n\n  if (method) {\n    options.method = method\n  }\n  \n  const res = await fetch(host + url, options)\n  if (res.status >= 200 && res.status <= 299) {\n    const data = await res.json()\n    return Promise.resolve(data)\n  }\n\n  errorState.updateError(res.error)\n}\n\nexport default {\n  signup: async body => {\n    const data = await request('/signup', body);\n    return Promise.resolve(data)\n  },\n  search: async body => {\n    const data = await request('/search', body);\n    return Promise.resolve(data)\n  },\n  addVideo: async body => {\n    const data = await request('/addVideo', body);\n    return Promise.resolve(data)\n  },\n};", "import { FormState, errorState, host } from '../common/global.js';\nimport api from '../common/api';\nconst formState = new FormState()\n\nlet player;\nlet mainSocket;\nlet clubSocket;\nlet intervalId;\nlet syncIntervalId\nconst user = JSON.parse(localStorage.getItem('user'));\nlet trackPosition = 0;\n\nfunction onYouTubeIframeAPIReady() {\n  const options = {\n    height: '300',\n    width: '500',\n    playerVars: {\n      cc_load_policy: 0,\n      controls: 0,\n      disablekb: 1,\n      enablejsapi: 1,\n      fs: 0,\n      modestbranding: 1\n    },\n    events: {\n      onReady: onPlayerReady,\n      onStateChange: onPlayerStateChange,\n      onError: onPlayerError\n    }\n  }\n\n  const videoId = document.querySelector('#videoId');\n  if (videoId) {\n    options.videoId = videoId.getAttribute('value');\n  }\n  player = new YT.Player('player', options)\n}\n\nwindow.onload = () => {\n  const form = document.querySelector('.main--search');\n  formState.init(form);\n  form.addEventListener('submit', formSubmit);\n  addHistoryListeners()\n  \n  mainSocket = io(host)\n  mainSocket.on('connect', () => {\n    console.log('Main socket connected');\n    mainSocket.emit('setUpNs', user.clubId);\n  })\n\n  clubSocket = io(`/${user.clubId}`)\n  clubSocket.on('connect', () => {\n    console.log('Club socket connected');\n    onYouTubeIframeAPIReady()\n  })\n};\n\nfunction emitClubInfo () {\n  console.log('Initializing club');\n  clubSocket.emit('setUpClub', user._id)\n}\n\nfunction updateClubState (club) {\n  console.log(club);\n  const videoId = document.querySelector('#videoId');\n  if (videoId) {\n    player.seekTo(club.ellapsedSeconds, true);\n  }\n  updateMembers(club.members); \n}\n\nfunction emitSeconds () {\n  intervalId = setInterval(() => {\n    const data = {\n      currentPosition: player.getCurrentTime(),\n      clubId: user.clubId,\n      userId: user._id\n    }\n\n    clubSocket.emit('updateSync', data);\n  }, 200)\n}\n\nfunction addHistoryListeners () {\n  const ul = document.querySelector('.main--history-list');\n  const children = ul.getElementsByTagName('li');\n\n  for (let li of children) {\n    const videoId = li.getAttribute('id')\n    const button = li.getElementsByTagName('button')[0];\n    const name = button.getElementsByTagName('p')[0].innerText\n    addVideoListener(button, null,  name, videoId)\n  }\n}\n\nfunction updateMembers (members) {\n  const ul = document.querySelector('.main--squad-list');\n  const children = ul.getElementsByTagName('li')\n\n  members.forEach(memberId => {\n    for (let member of children ) {\n      if (member.id.toString() === memberId.toString()) {\n        const memberChildren = member.getElementsByTagName('span')\n        memberChildren[1].className = 'u--green-circle';\n      }\n    }\n  });\n}\n\nfunction initSocket () {\n  clubSocket.on('updateClubState', updateClubState)\n  clubSocket.on('updatePlaylist', updatePlaylist);\n  clubSocket.on('memberLeft', updateMembers);\n  document.addEventListener(\"beforeunload\", function() {\n    const userId = user._id;\n    const clubId = user.clubId;\n    clubSocket.emit('pageClose', {userId, clubId})\n  });\n  clubSocket.on('syncTrack', updateTrackPosition)\n  console.log('Initialized socket listeners');\n}\n\nfunction updateTrackPosition (position) {\n  trackPosition = position\n}\n\nfunction onPlayerReady (event) {\n  event.target.setVolume(100)\n  console.log('Initialized youtube player');\n  initSocket()\n  emitClubInfo()\n}\n\nasync function formSubmit (event) {\n  event.preventDefault();\n  const query = formState.formData();\n  const data = await api.search(query);\n  const resultSection = document.querySelector('.main--search-results');\n  resultSection.innerText = \"\";\n  const resultsList = createResultList(data.results);\n  resultSection.appendChild(resultsList);\n}\n\nfunction addVideoListener (btn, ul, name, videoId) {\n  btn.addEventListener('click', async (event) => {\n    /* if video is from search results, \n    clear search results */\n    if (ul) {\n      ul.innerText = \"\";\n    }\n\n    const body = {\n      name,\n      videoId\n    }\n\n    const data = await api.addVideo(body)\n    addToPlaylist(data);\n  })\n}\n\nfunction createResultList (data) {\n  const list = new DocumentFragment();\n  const ul = document.createElement('ul');\n  ul.className = 'main--result-list';\n\n  data.items.forEach(item => {\n    const li = document.createElement('li');\n    const button = document.createElement('button');\n    button.className = 'btn--result';\n    addVideoListener(button, ul, item.snippet.title, item.id.videoId);\n\n    const span = document.createElement('span');\n    const title = document.createTextNode(item.snippet.title);\n    span.appendChild(title)\n\n    const img = document.createElement('img');\n    img.setAttribute('src', item.snippet.thumbnails.default.url);\n    img.className = 'thumbnail';\n\n    button.appendChild(span);\n    button.appendChild(img);\n    li.appendChild(button)\n    ul.appendChild(li);\n  })\n\n  list.append(ul)\n  return list\n}\n\nfunction addToPlaylist (data) {\n  const { \n    currentlyPlaying, \n    queuedVideo,\n   } = data;\n  \n  if (!queuedVideo && currentlyPlaying) {\n    let currentVideo = document.querySelector('.main--playing');\n    const currentVideoName = document.createTextNode(currentlyPlaying.name); \n    const currentUserName = document.createTextNode(currentlyPlaying.userFullName); \n    \n    const li = document.createElement('li');\n    const div = document.createElement('div');\n    const input = document.createElement('input');\n    input.setAttribute('value', currentlyPlaying.videoId);\n    input.setAttribute('id', 'videoId');\n    input.setAttribute('type', 'hidden');\n    \n    div.className=\"main--name-highlight\";\n    div.appendChild(currentUserName);\n    li.appendChild(currentVideoName);\n    li.appendChild(div);\n    li.appendChild(input);\n    currentVideo.appendChild(li);\n\n    player.loadVideoById(currentlyPlaying.videoId);\n  }\n  \n  if (queuedVideo) {\n    const upNext = document.querySelector('.main--up-next');\n    const videoName = document.createTextNode(queuedVideo.name); \n    const userName = document.createTextNode(queuedVideo.userFullName); \n     \n    const li = document.createElement('li');\n    const div = document.createElement('div');\n    div.className=\"main--name-highlight\"\n    div.appendChild(userName)\n    li.appendChild(videoName);\n    li.appendChild(div)\n    upNext.appendChild(li);\n  }\n}\n\nfunction updatePlaylist (data) {\n  const { \n    currentlyPlaying, \n    playlist, \n    ellapsedSeconds,\n  } = data;\n  let currentVideo = document.querySelector('.main--playing');\n  currentVideo.innerText = '';\n\n  const currentVideoName = document.createTextNode(currentlyPlaying.name); \n  const currentUserName = document.createTextNode(currentlyPlaying.userFullName); \n  \n  const li = document.createElement('li');\n  const div = document.createElement('div');\n  div.className=\"main--name-highlight\"\n  div.appendChild(currentUserName)\n  li.appendChild(currentVideoName);\n  li.appendChild(div)\n  currentVideo.appendChild(li);\n  \n  player.loadVideoById(currentlyPlaying.videoId, ellapsedSeconds)\n\n  const upNext = document.querySelector('.main--up-next');\n  upNext.innerText = \"\"\n\n  playlist.forEach(video => {\n    const videoName = document.createTextNode(video.name); \n    const userName = document.createTextNode(video.userFullName); \n      \n    const li = document.createElement('li');\n    const div = document.createElement('div');\n    div.className=\"main--name-highlight\"\n    div.appendChild(userName)\n    li.appendChild(videoName);\n    li.appendChild(div)\n    upNext.appendChild(li);\n  })\n}\n\nfunction removeLast () {\n  let currentVideo = document.querySelector('.main--playing');\n  currentVideo.innerText = '';\n  clearInterval(intervalId)\n  clearInterval(syncIntervalId);\n  syncIntervalId = null\n}\n\nfunction onPlayerStateChange(event) {\n  const upNext = document.querySelector('.main--up-next');\n  const videoCount = upNext.getElementsByTagName('li').length\n\n  if(event.data === YT.PlayerState.ENDED && videoCount > 0) {\n    console.log('Load next video. Status: next');\n    clubSocket.emit('playNext', user.clubId);\n    clearInterval(intervalId);\n    clearInterval(syncIntervalId);\n    syncIntervalId = null\n  }\n\n  if(\n    event.data === YT.PlayerState.ENDED && \n    videoCount === 0\n  ) {\n    console.log('Last video. Status: finished');\n    clubSocket.emit('removeLast', user.clubId);\n    removeLast()\n  }\n\n  if(event.data === YT.PlayerState.PLAYING) {\n    emitSeconds();\n    syncIntervalId = setInterval(() => {\n      if (trackPosition > event.target.getCurrentTime()) {\n        event.target.seekTo(trackPosition, true)\n      }\n    }, 10000)\n  }\n}\n\nfunction onPlayerError(event) {\n  const upNext = document.querySelector('.main--up-next');\n  const videoCount = upNext.getElementsByTagName('li').length\n  errorState.updateError(`Error loading video. code ${event.data}`)\n\n  if(videoCount > 1) {\n    clubSocket.emit('playNext', user.clubId);\n    clearInterval(intervalId);\n    clearInterval(syncIntervalId);\n    syncIntervalId = null\n  }\n\n  if(videoCount === 1) {\n    clubSocket.emit('removeLast', user.clubId);\n    removeLast()\n  }  \n};\n\n"],
  "mappings": "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",
  "names": []
}
